<div class="catalogo-wrapper animate-fade-in">
  <div class="encabezado text-center mb-5">
    <h1 class="titulo-pagina fw-bold">Catálogo de Servicios</h1>
    <p class="text-muted fs-5">Encuentra todo lo que necesitas para tu evento soñado.</p>
  </div>

  <div *ngIf="cargando" class="text-center py-5">
    <div class="spinner-grow text-primary" role="status"></div>
    <p class="mt-3 text-muted">Sincronizando con la base de datos...</p>
  </div>

  <div class="row g-4" *ngIf="!cargando">
    <div class="col-12 col-md-6 col-lg-4" *ngFor="let s of services">
      <div class="card h-100 border-0 shadow-sm card-servicio">
        <div class="position-relative overflow-hidden">
          <img [src]="s.imagenURL" class="card-img-top img-fixed" [alt]="s.nombre">
          <span class="badge position-absolute top-0 end-0 m-3 shadow-sm" [ngClass]="getBadgeClass(s.clasificacion)">
            {{ s.clasificacion | uppercase }}
          </span>
        </div>

        <div class="card-body d-flex flex-column">
          <h5 class="card-title fw-bold text-dark">{{ s.nombre }}</h5>
          <p class="card-text text-muted small flex-grow-1">{{ s.descripcion }}</p>
          
          <div class="bg-light p-2 rounded-3 mb-3">
            <div class="d-flex justify-content-between small">
              <span class="text-muted">Categoría:</span>
              <span class="fw-bold text-primary">{{ getCategoryName(s.categoriaID) }}</span>
            </div>
            <div class="d-flex justify-content-between mt-1">
              <span class="text-muted small">Precio:</span>
              <span class="fw-bold text-success">{{ s.precio | currency:'USD' }}</span>
            </div>
          </div>

          <div class="d-grid gap-2 d-md-flex">
            <a [routerLink]="['/eventos-view', s.servicioID]" class="btn btn-outline-primary btn-sm flex-fill rounded-pill">
              Ver detalles
            </a>
            <button (click)="openOrderModal(s)" class="btn btn-primary btn-sm flex-fill rounded-pill">
              Solicitar
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="modal fade" id="orderModal" tabindex="-1" #orderModalRef>
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content border-0 shadow">
      <div class="modal-header bg-morado text-white">
        <h5 class="modal-title fw-bold">Confirmar Solicitud</h5>
        <button type="button" class="btn-close btn-close-white" (click)="modalRef.hide()"></button>
      </div>
      <form [formGroup]="formOrder" (ngSubmit)="saveOrder()">
        <div class="modal-body p-4">
          <div *ngIf="selectedService" class="alert alert-info border-0 shadow-sm mb-4">
            <h6 class="fw-bold mb-1">{{ selectedService.nombre }}</h6>
            <span class="small">Total a pagar: <strong>{{ selectedService.precio | currency:'USD' }}</strong></span>
          </div>

          <div class="mb-3">
            <label class="form-label fw-bold">Selecciona el Cliente</label>
            <select class="form-select" formControlName="usuarioID" [class.is-invalid]="isFieldInvalid('usuarioID')">
              <option value="">-- Elige un usuario --</option>
              <option *ngFor="let u of users" [value]="u.usuarioID">{{ u.nombre }} ({{ u.email }})</option>
            </select>
          </div>

          <div class="mb-3">
            <label class="form-label fw-bold">Fecha del Evento</label>
            <input type="date" class="form-control" formControlName="fechaEvento" [class.is-invalid]="isFieldInvalid('fechaEvento')">
          </div>
        </div>
        <div class="modal-footer border-0">
          <button type="button" class="btn btn-light rounded-pill px-4" (click)="modalRef.hide()">Cerrar</button>
          <button type="submit" class="btn btn-primary rounded-pill px-4">Confirmar Pedido</button>
        </div>
      </form>
    </div>
  </div>
</div>